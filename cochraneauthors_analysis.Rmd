---
title: "A meta-research on the Cochrane Reviews' authors"
author: "Ahmad Sofi-Mahmudi"
date: "`r Sys.Date()`"
output: html_document
---

# Loading required packages

```{r}
pacman::p_load(dplyr,
               here,
               purrr,
               rvest)
```


# Loading the datasets
```{r}
reviews <- read.csv(here("data", "cochraneauthors_db_may8.csv"))
```

## Getting the URL list:
```{r}
URLlist <- data.frame(DOI=reviews$DOI, 
                      URL=paste0("https://www.cochranelibrary.com/cdsr/doi/",reviews$DOI,"/information"))
```

## Catching the authros information using webscrapping from CochraneLibrary.com website:
```{r}
slicedlist <- list(countries1000 = slice(URLlist, 1:1000),
                   countries2000 = slice(URLlist, 1001:2000),
                   countries3000 = slice(URLlist, 2001:3000),
                   countries4000 = slice(URLlist, 3001:4000),
                   countries5000 = slice(URLlist, 4001:5000),
                   countries6000 = slice(URLlist, 5001:6000),
                   countries7000 = slice(URLlist, 6001:7000),
                   countries8000 = slice(URLlist, 7001:8000),
                   countries9000 = slice(URLlist, 8001:nrow(URLlist)))

a <- read_html(slicedlist[1][[1]]$URL[1]) %>% html_nodes(".authors") %>% 
  map(~html_nodes(.x, 'li') %>% 
        html_text() %>% 
        gsub(pattern = '\\t|\\r|\\n', replacement = ''))


countries <- tryCatch(as.data.frame(affiliations = pbsapply(countries$URL, function(url) {
  read_html(url) %>% html_nodes(".authors") %>% 
    html_text()
})), error = function(e) {NA})
```

